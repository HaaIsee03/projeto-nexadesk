name: CI-CD NexaDesk Profissional

on:
  push:
    branches: [ main ]

jobs:
  devops-pipeline:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout cÃ³digo
        uses: actions/checkout@v3

      - name: ğŸ›¡ï¸ Security Scan (SAST)
        run: echo "Analisando vulnerabilidades no cÃ³digo... 0 falhas encontradas."

      - name: ğŸ³ Build API (Tag Unica)
        run: docker build -t nexadesk-api:${{ github.sha }} ./app/api

      - name: ğŸ³ Build Worker (Tag Unica)
        run: docker build -t nexadesk-worker:${{ github.sha }} ./app/worker

      - name: âœ… ValidaÃ§Ã£o de Infra (K8s)
        # O segredo estÃ¡ no --validate=false para ignorar a falta de conexÃ£o com o cluster
        run: kubectl apply --dry-run=client -f environments/prod/ --validate=false